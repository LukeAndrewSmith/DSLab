import os
import sys

from ctypes.wintypes import POINT

from ringdetector.preprocessing.ImageAnnotation import ImageAnnotation
from ringdetector.Paths import IMAGES, POINT_LABELS

def getTestCoreAnnotation():
    labelmeJson = os.path.join(IMAGES, 'KunA08.json')
    return ImageAnnotation(labelmeJson, POINT_LABELS).core_annotations[0]

def testInitPositionLabels(core):
    assert( core.pointLabels == [[[10.096, 13.039]], [[11.176, 13.144]], [[12.044, 13.229]], [[13.589, 13.356]], [[17.293, 13.906]], [[21.823, 14.774], [22.585, 11.24]], [[27.665, 12.404]], [[34.925, 14.16], [35.475, 11.959]], [[41.317, 13.864], [42.122, 11.24]], [[49.255, 14.288], [50.863, 11.324]], [[58.526, 17.166], [63.204, 10.985]], [[70.337, 16.002], [73.85, 11.218]], [[80.814, 16.277], [85.048, 11.684]], [[90.318, 16.319], [94.7, 11.663]], [[100.309, 16.468], [104.86, 11.938]], [[108.162, 15.43], [111.845, 11.959]], [[114.491, 14.372], [116.798, 12.002]], [[119.211, 14.182]], [[121.031, 15.748], [123.825, 12.319]], [[127.783, 15.346], [130.027, 12.234]], [[133.583, 14.436], [135.043, 12.213]], [[139.425, 15.092], [141.33, 12.298]], [[145.013, 14.668], [146.643, 12.213]], [[150.156, 14.817], [152.125, 12.319]], [[155.66, 15.452], [158.623, 12.361]], [[161.798, 15.875], [165.798, 12.34]], [[168.233, 15.113], [170.942, 12.615]], [[174.329, 15.642], [176.488, 13.018]], [[180.065, 14.626], [180.763, 12.89]], [[183.705, 13.25], [183.451, 15.049]], [[186.923, 14.901]], [[190.966, 14.499]], [[195.051, 13.991]], [[201.612, 13.25], [201.888, 16.192]], [[208.216, 15.6]], [[214.164, 15.113]], [[219.583, 14.838]], [[224.515, 14.69]], [[230.738, 14.774]], [[237.829, 15.748], [238.167, 13.335]], [[247.057, 16.214], [247.925, 13.716]], [[255.651, 16.87], [257.069, 13.631]], [[264.732, 16.552], [265.874, 13.695]], [[273.346, 16.383], [274.426, 13.695]], [[280.056, 15.96], [281.051, 13.589]], [[284.628, 15.134]], [[287.189, 16.023], [288.036, 14.266]], [[289.094, 14.838]], [[289.391, 15.007]], [[289.772, 15.24]], [[290.386, 15.6]], [[291.02, 15.939]], [[292.142, 16.468]], [[293.222, 16.891]], [[294.936, 17.568], [296.376, 14.393]], [[300.609, 16.066], [301.456, 13.97]], [[306.663, 16.425], [307.89, 14.266]], [[312.272, 17.166], [314.24, 14.372]], [[316.759, 16.298], [318.368, 14.034]], [[321.818, 16.785], [323.892, 14.203]], [[328.549, 18.098], [331.957, 14.076]], [[335.576, 17.06], [337.883, 14.309]], [[341.334, 17.23], [343.725, 14.478]], [[347.218, 17.568], [350.097, 14.309]], [[353.97, 17.208], [356.129, 14.499]], [[358.648, 16.362], [360.172, 14.266]], [[364.321, 16.574], [365.442, 14.52]], [[369.083, 16.214], [369.909, 14.436]], [[373.698, 16.192]], [[377.444, 18.436], [379.772, 14.69]], [[384.238, 18.182], [387.202, 14.711]], [[391.774, 18.944], [396.24, 14.88]], [[398.97, 18.5], [403.945, 14.965]], [[406.4, 18.161], [410.908, 15.198]], [[412.644, 18.584], [418.91, 15.304]], [[420.92, 19.304], [430.488, 15.198]], [[431.609, 18.986], [447.273, 16.51]], [[447.103, 19.537]]])

def testInitInnerRectangle(core):
    line1 = core.innerRectangle[0][1] - core.innerRectangle[3][1] # Top left to top right
    line2 = core.innerRectangle[1][1] - core.innerRectangle[2][1] # Bottom left to bottom right
    assert( line1 == line2 ) # Should be parrallel if it's a rectangle

if __name__ == "__main__":
    core = getTestCoreAnnotation()
    testInitPositionLabels(core)
    testInitInnerRectangle(core)
    # TODO: Write comprehensive tests